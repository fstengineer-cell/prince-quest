<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Prince & Princess Quest</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon.png">
    <link rel="manifest" href="manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fff5f7">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient-start: #fdfbfb; --bg-gradient-end: #ebedee;
            --container-bg: #fff5f7; --container-border: #ffd1dc;
            --accent-yellow: #fdfd96; --accent-peach: #ffcaaf;
            --text-dark: #6b5b65; --btn-good-bg: #b7e4c7;
            --btn-good-shadow: #95d5b2; --btn-bad-bg: #ffb3c1;
            --btn-bad-shadow: #ff8fa3; --path-color: #fae3d9;
        }
        body { font-family: 'Prompt', 'Fredoka One', sans-serif; background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: var(--text-dark); box-sizing: border-box; }
        .container { width: 100%; max-width: 450px; background: var(--container-bg); padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px rgba(107, 91, 101, 0.1), 0 0 0 8px var(--container-border), inset 0 0 20px rgba(255, 255, 255, 0.5); text-align: center; position: relative; overflow: hidden; border: 3px solid white; padding-bottom: 40px; }
        
        /* Header & User Switch */
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h1 { margin: 0; font-size: 1.4rem; color: var(--text-dark); text-shadow: 2px 2px 0px #fff; flex-grow: 1; text-align: left; }
        .switch-user-btn { background: #fff; border: 2px solid var(--container-border); border-radius: 15px; padding: 5px 10px; font-size: 0.8rem; cursor: pointer; color: var(--text-dark); font-family: 'Prompt', sans-serif; }

        .score-board { background: rgba(255, 255, 255, 0.7); border-radius: 50%; width: 120px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto 20px auto; border: 6px solid var(--accent-yellow); box-shadow: 0 0 25px var(--accent-yellow), inset 0 0 10px white; animation: pulsePastel 2s infinite alternate; color: var(--text-dark); }
        .star-display-num { font-size: 4rem; font-weight: bold; text-shadow: 2px 2px 0 #fff; line-height: 1; font-family: 'Fredoka One', cursive; }
        
        .journey-track-container { position: relative; height: 140px; background: linear-gradient(to bottom, #d4fcff, #eefcff); border-radius: 20px; margin-bottom: 25px; border: 4px solid white; box-shadow: inset 0 0 15px rgba(180, 220, 255, 0.4); overflow: hidden; }
        .track-path { position: absolute; bottom: 10px; left: 0; width: 100%; height: 45px; background: var(--path-color); border-top: 4px dotted rgba(255,255,255,0.8); border-bottom: 4px solid rgba(255,240,240,0.5); border-radius: 20px; }
        
        /* Images */
        .goal-img { position: absolute; right: 10px; bottom: 15px; height: 95px; width: auto; z-index: 1; filter: drop-shadow(0 4px 4px rgba(255,255,255,0.8)); transition: all 0.5s ease; }
        .rider-container { position: absolute; bottom: 20px; left: 0; transition: left 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 2; display: flex; flex-direction: column; align-items: center; width: auto; }
        .rider-img { height: 95px; width: auto; filter: drop-shadow(0 4px 4px rgba(255,255,255,0.8)); margin-bottom: -8px; }

        .btn-group { display: flex; gap: 15px; margin-top: 20px; }
        button.action-btn { flex: 1; padding: 15px; border: 4px solid white; border-radius: 25px; font-family: 'Prompt', sans-serif; font-weight: bold; font-size: 1.2rem; cursor: pointer; color: var(--text-dark); transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 8px; text-shadow: 1px 1px 0 rgba(255,255,255,0.5); position: relative; overflow: hidden; }
        button.action-btn::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: rgba(255,255,255,0.4); border-radius: 25px 25px 10px 10px; pointer-events: none; }
        button.action-btn:active { transform: scale(0.95); }
        .btn-good { background: var(--btn-good-bg); box-shadow: 0 6px 0 var(--btn-good-shadow); }
        .btn-bad { background: var(--btn-bad-bg); box-shadow: 0 6px 0 var(--btn-bad-shadow); }
        
        .history { margin-top: 30px; text-align: left; width: 100%; background: rgba(255,255,255,0.8); color: var(--text-dark); padding: 15px; border-radius: 20px; box-sizing: border-box; border: 3px solid var(--container-border); margin-bottom: 20px; }
        .history h3 { margin-top: 0; font-size: 1rem; border-bottom: 2px dashed var(--container-border); padding-bottom: 8px; text-align: center; }
        #logList { list-style: none; padding: 0; font-size: 0.9rem; max-height: 120px; overflow-y: auto; }
        #logList li { padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05); display: flex; justify-content: space-between; }
        .positive { color: #74c69d; font-weight: bold; }
        .negative { color: #ff8fa3; font-weight: bold; }
        
        .goal-setting-area { background: rgba(255,255,255,0.5); padding: 15px; border-radius: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; border: 2px solid var(--container-border); width: 90%; margin: 0 auto; }
        .goal-label { font-size: 1rem; color: var(--text-dark); }
        #goalInput { width: 60px; padding: 5px; border-radius: 10px; border: 3px solid var(--accent-peach); background: #fff; text-align: center; font-family: 'Fredoka One', sans-serif; font-size: 1.1rem; color: var(--text-dark); outline: none; }
        .goal-set-btn { padding: 8px 15px; border-radius: 10px; border: none; background: var(--accent-peach); color: white; font-family: 'Prompt', sans-serif; cursor: pointer; box-shadow: 0 4px 0 #e0b098; }
        .reset-btn { margin-top: 25px; background: rgba(255,255,255,0.5); color: var(--text-dark); border: 2px solid var(--container-border); padding: 10px 20px; font-size: 0.9rem; cursor: pointer; border-radius: 15px; }

        /* User Selection Overlay */
        #userSelectOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #fdfbfb 0%, #ffeef2 100%); z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .user-select-card { background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 80%; max-width: 350px; border: 4px solid #fff; outline: 4px solid var(--container-border); }
        .user-btn { width: 100%; margin: 10px 0; padding: 15px; border-radius: 20px; border: none; font-size: 1.2rem; cursor: pointer; font-family: 'Prompt', sans-serif; font-weight: bold; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .user-btn:active { transform: scale(0.95); }
        .btn-angtang { background: #b7e4c7; color: #2d6a4f; box-shadow: 0 5px 0 #95d5b2; }
        .btn-ongtong { background: #ffb3c1; color: #a4133c; box-shadow: 0 5px 0 #ff8fa3; }

        /* Celebration */
        #celebrationOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 240, 245, 0.95); z-index: 100; display: none; flex-direction: column; justify-content: center; align-items: center; color: var(--text-dark); text-align: center; }
        .crown-animate { font-size: 8rem; margin-bottom: 20px; animation: floatCrown 3s ease-in-out infinite; filter: drop-shadow(0 0 20px var(--accent-yellow)); }
        @keyframes floatCrown { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
        .celebrate-text { font-size: 2rem; color: var(--text-dark); text-shadow: 2px 2px 0 #fff; margin-bottom: 30px; font-family: 'Prompt', sans-serif; }
        .firework { position: absolute; width: 15px; height: 15px; border-radius: 50%; animation: explode 1s ease-out forwards; opacity: 0; }
        @keyframes explode { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(15); opacity: 0; } }

    </style>
</head>
<body>

    <div id="userSelectOverlay">
        <div class="user-select-card">
            <h2 style="color:var(--text-dark); margin-top:0;">‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏≠‡πà‡∏¢?</h2>
            <button class="user-btn btn-angtang" onclick="selectUser('angtang')">
                üë¶ ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏≠‡∏á‡πÅ‡∏ï‡∏á
            </button>
            <button class="user-btn btn-ongtong" onclick="selectUser('ongtong')">
                üëß ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏á‡∏ï‡∏≠‡∏á
            </button>
        </div>
    </div>

    <div class="container">
        <div class="header-area">
            <h1 id="userTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô...</h1>
            <button class="switch-user-btn" onclick="showUserSelect()">üë§ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ô</button>
        </div>
        
        <div class="score-board">
            <span id="score" class="star-display-num">0</span> 
        </div>
        
        <div class="journey-track-container">
            <div class="track-path"></div>
            <img src="" alt="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" id="goalImg" class="goal-img">
            <div class="rider-container" id="riderContainer">
                <img src="" alt="‡∏Ñ‡∏ô‡∏Ç‡∏µ‡πà‡∏°‡πâ‡∏≤" id="riderImg" class="rider-img">
            </div>
        </div>

        <div class="btn-group">
            <button class="action-btn btn-good" onclick="updateScore(1)">
                <span>üíñ</span> ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            </button>
            <button class="action-btn btn-bad" onclick="updateScore(-1)">
                <span>üíß</span> ‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
            </button>
        </div>

        <div class="history">
            <h3 id="historyTitle">‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
            <ul id="logList"></ul>
        </div>
        
        <div class="goal-setting-area">
            <label for="goalInput" class="goal-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</label>
            <input type="number" id="goalInput" value="10" min="1">
            <button class="goal-set-btn" onclick="changeGoalTarget()">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
        </div>

        <button class="reset-btn" onclick="resetData()">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div id="celebrationOverlay" onclick="closeCelebration()">
        <div class="crown-animate">üëë</div>
        <div class="celebrate-text" id="celebrateMsg">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</div>
        <p style="font-size: 1rem; font-family: 'Prompt', sans-serif;">‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</p>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        const USERS = {
            'angtang': {
                name: '‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏≠‡∏á‡πÅ‡∏ï‡∏á',
                storageKey: 'questData_Angtang',
                rider: 'prince.png',   // ‡πÄ‡∏à‡πâ‡∏≤‡∏ä‡∏≤‡∏¢
                goal: 'princess.png',  // ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á
                winMsg: '‡∏û‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                themeColor: '#e3f2fd'
            },
            'ongtong': {
                name: '‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏á‡∏ï‡∏≠‡∏á',
                storageKey: 'questData_Ongtong',
                rider: 'princess.png', // ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á
                goal: 'prince.png',    // ‡πÄ‡∏à‡πâ‡∏≤‡∏ä‡∏≤‡∏¢
                winMsg: '‡∏û‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏ä‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!',
                themeColor: '#fff5f7'
            }
        };

        let currentUser = null;
        let gameState = { score: 0, goal: 10, logs: [] };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏Ñ‡∏£‡πÑ‡∏ß‡πâ‡πÑ‡∏´‡∏°
        window.onload = function() {
            const lastUser = localStorage.getItem('questLastUser');
            if (lastUser && USERS[lastUser]) {
                selectUser(lastUser);
            } else {
                showUserSelect();
            }
        };

        function showUserSelect() {
            document.getElementById('userSelectOverlay').style.display = 'flex';
        }

        function selectUser(userKey) {
            currentUser = USERS[userKey];
            localStorage.setItem('questLastUser', userKey); // ‡∏à‡∏≥‡∏Ñ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            document.getElementById('userSelectOverlay').style.display = 'none';
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏ï‡∏≤‡∏° user
            document.getElementById('userTitle').innerText = `‚ú® ${currentUser.name} ‚ú®`;
            document.getElementById('riderImg').src = currentUser.rider;
            document.getElementById('goalImg').src = currentUser.goal;
            document.querySelector('.container').style.backgroundColor = currentUser.themeColor;
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô
            loadData();
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏¢‡∏Å key ‡∏ï‡∏≤‡∏° user)
        function loadData() {
            const saved = localStorage.getItem(currentUser.storageKey);
            if (saved) {
                gameState = JSON.parse(saved);
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                gameState = { score: 0, goal: 10, logs: [] };
            }
            updateDisplay();
            renderLogs();
        }

        function saveData() {
            localStorage.setItem(currentUser.storageKey, JSON.stringify(gameState));
            updateDisplay();
            renderLogs();
        }

        // Logic ‡πÄ‡∏Å‡∏°
        function updateScore(value) {
            let newScore = gameState.score + value;
            if (newScore < 0) newScore = 0;

            const timestamp = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
            const actionText = value > 0 ? "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏∂‡πâ‡∏ô" : "‡∏ñ‡∏≠‡∏¢‡∏´‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ";
            
            const newLog = { time: timestamp, action: actionText, val: value };
            
            gameState.score = newScore;
            gameState.logs.unshift(newLog); 
            if(gameState.logs.length > 20) gameState.logs.pop(); 

            saveData();
            checkGoal();
        }

        function changeGoalTarget() {
            const inputVal = document.getElementById('goalInput').value;
            const newGoal = parseInt(inputVal);
            
            if(newGoal && newGoal > 0) {
                if(confirm(`‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${currentUser.name} \n‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏´‡∏°?`)) {
                    const timestamp = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
                    gameState.score = 0;
                    gameState.goal = newGoal;
                    gameState.logs = [{ time: timestamp, action: "‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà", val: 0 }];
                    saveData();
                }
            } else {
                alert("‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0");
            }
        }

        function resetData() {
            if(confirm(`‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á ${currentUser.name} ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà?`)) {
                gameState = { score: 0, goal: 10, logs: [] };
                document.getElementById('goalInput').value = 10;
                saveData();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function updateDisplay() {
            document.getElementById('score').innerText = gameState.score;
            document.getElementById('goalInput').value = gameState.goal;
            document.getElementById('historyTitle').innerText = `‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (${currentUser.name})`;

            const rider = document.getElementById('riderContainer');
            let safeDistancePixel = 110; 
            let progressRatio = gameState.score / gameState.goal;
            if (progressRatio > 1) progressRatio = 1;
            if (progressRatio < 0) progressRatio = 0;
            rider.style.left = `calc((100% - ${safeDistancePixel}px) * ${progressRatio})`;
        }

        function renderLogs() {
            const list = document.getElementById('logList');
            list.innerHTML = "";
            gameState.logs.forEach(log => {
                const li = document.createElement('li');
                if(log.val === 0) {
                    li.innerHTML = `<span>üö© ${log.time} - ${log.action}</span> <span style="color:#aaa;">--</span>`;
                } else {
                    const sign = log.val > 0 ? "+" : "";
                    const colorClass = log.val > 0 ? "positive" : "negative";
                    const icon = log.val > 0 ? "üå∏" : "‚òÅÔ∏è";
                    li.innerHTML = `<span>${icon} ${log.time} - ${log.action}</span> <span class="${colorClass}">${sign}${log.val}</span>`;
                }
                list.appendChild(li);
            });
        }

        function checkGoal() {
            if(gameState.score >= gameState.goal && gameState.score > 0) {
                 if(document.getElementById('celebrationOverlay').style.display !== 'flex') {
                    showCelebration();
                }
            }
        }

        // Celebration
        let fireworkInterval;
        function showCelebration() {
            document.getElementById('celebrateMsg').innerText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!\n${currentUser.winMsg}`;
            const overlay = document.getElementById('celebrationOverlay');
            overlay.style.display = 'flex';
            for(let i=0; i<5; i++) { createFirework(); }
            fireworkInterval = setInterval(() => { createFirework(); }, 800);
        }
        function closeCelebration() {
            document.getElementById('celebrationOverlay').style.display = 'none';
            clearInterval(fireworkInterval);
            document.querySelectorAll('.firework').forEach(fw => fw.remove());
        }
        function createFirework() {
            const overlay = document.getElementById('celebrationOverlay');
            const fw = document.createElement('div');
            fw.classList.add('firework');
            fw.style.left = Math.random() * 80 + 10 + '%';
            fw.style.top = Math.random() * 60 + 10 + '%';
            const colors = ['#fdfd96', '#ffb3c1', '#b7e4c7', '#a2d2ff', '#ffcaaf'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            fw.style.backgroundColor = randomColor;
            fw.style.boxShadow = `0 0 20px 5px rgba(255,255,255,0.8)`;
            overlay.appendChild(fw);
            setTimeout(() => { fw.remove(); }, 1000);
        }
    </script>
</body>
</html>
